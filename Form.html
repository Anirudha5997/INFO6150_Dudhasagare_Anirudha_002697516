<!doctype html>
<html lang="en">
 <head>
  <title>Feedback</title>
  <style>
    label {	float: left;
			width: 150px;}
      #container{
          width: 700px;
          margin: auto;
          background-color: beige;
      } 
      main{
          padding: 50px;
      }
  </style>
 </head>
 <body>
 <div id="container">
	 
	 <main>
	 <h2>Feeback</h2>
	 <h3>Love something? Hate something? Let us know!</h3>
		 Note : Fields marked with an asterisk(*) are mandatory
		 <br><br>
		 <form id="myForm" method="post" novalidate>
			<label>Title*:</label>
			<input type="radio" name="title" id="miss" value="miss" required="required"/>Miss
			<input type="radio" name="title" id="mr" value="mr" required="required"/>Mr.
			<input type="radio" name="title" id="mrs" value="mrs" required="required"/>Mrs.
			<br><br>
			<label for="firstName">First Name*:</label>
			<input type="text" name="firstName" id="firstName" placeholder="First Name" minlength="2" maxlength="20" required/>	
			<br><br>
			<div id="error_firstName" style="display: none; color:red;">
				Invalid First Name format, Please enter a valid name.
			</div>
			

			<label for="lastName">Last Name*:</label>
			<input type="text" name="lastName" id="lastName" placeholder="Last Name" minlength="2" maxlength="20" required/>
			<br><br>
			<div id="error_lastName" style="display: none; color:red;">
				Invalid Last Name format, Please enter a valid name.
			</div>
			

			<label for="emailId">Email Id*:</label>
			<input type="text" name="emailId" id="emailId" placeholder="yourname@domain.com" minlength="7" maxlength="40" required/>
			<br><br>
			<div id="error_emailId" style="display: none; color:red;">
				Invalid Email Id format, Please enter a Email ID.
			</div>
			

			<label for="phoneNumber">Phone Number*:</label>
			<input type="text" name="phoneNumber" id="phoneNumber" placeholder="xxx-xxx-xxxx" minlength="10" maxlength="10" required/>
			<br><br>
			<div id="error_phoneNumber" style="display: none; color:red;">
				Invalid Phone Number format, Please enter a valid Phone Number.
			</div>
			
            <label for="zipCode">ZipCode*:</label>
			<input type="text" name="zipcode" id="zipCode" placeholder="xxxxxx" minlength="5" maxlength="5" required/>
			<br><br>
			<div id="error_zipCode" style="display: none; color:red;">
				Invalid Zipcode format, Please enter a valid Zipcode.
			</div>
             
            <label for="zipcode">How did you hear*:</label>
			<input id="checkbox_FB" type='checkbox' name="source" value="facebook" /> Facebook
            <input id="checkbox_Google" type='checkbox' name="source" value="google" /> Google
            <input id="checkbox_Yelp" type='checkbox' name="source" value="yelp" /> Yelp 
			<br><br> 
             
			<label for="comments">Comments*:</label>
			<textarea name="text" id="comments" placeholder="Your comments" rows="5" cols="25"></textarea>
			<br><br>

			<label for="cars">Choose a car:</label>
			<select name="cars" id="cars">
				<option value=""> Please select an option </option>
				<option value="porsche">Porsche</option>
				<option value="audi">Audi</option>
				<option value="bmw">BMW</option>
				<option value="mercedes">Mercedes</option>
				<option value="lexus">Lexus</option>
			</select>

			  <br><br>
			  <br><br>

			  <label for="address1">Address Line 1*:</label>
			  <input type="text" name="address1" id="address1" placeholder="Enter your Address" required/>
			  <br><br>
			  <div id="error_address1" style="display: none; color:red;">
				  Invalid Address format, Please enter a valid address.
			  </div>
			<br><br>

			<label for="address2">Address Line 2*:</label>
			  <input type="text" name="address2" id="address2" placeholder="Enter your Address 2" required/>
			  <br><br>
			  <div id="error_address2" style="display: none; color:red;">
				  Invalid Address format, Please enter a valid address.
			  </div>
			<br><br>

			<input type="Submit" id="submitBtn" disabled>
			<input type="Reset" id="resetBtn">
			<br><br>
		 </form>
	 </main>
 </div>

 <script>

	let form = document.getElementById("myForm");
	form.addEventListener("submit", submitted);
	// form.addEventListener("change", submitbtn)


	//setting initally false to all validity states
	let defaultvalidCheck = {
		validFirstName : false,
		validLastName : false,
		validEmailId: false,
		validPhoneNumber: false,
		validZipCode: false,
		radioState : false,
		checkboxState: false,
		textAreaState: false,
		validAddress1: false,
		validAddress2: false,
		validCar: false,
		validCarCheckbox: false,
		validCarCheckboxText: false,
		}

		let validCheck = {...defaultvalidCheck}
	

	//setting regex expressions for each field
	let regExFirstName = /^[a-zA-Z]+$/;
	let regExLastName = /^[a-zA-Z]+$/;
	let regExEmailId = /([\w\.]+)@northeastern.edu/;
	let regExPhoneNumber = /\d{3}-?\d{3}-?\d{4}$/;
	let regExZipCode = /\b\d{5}\b/;
	let regExAddress = /^[a-zA-Z0-9\s,'-]+$/
	let regExAddress2 = /^[a-zA-Z0-9\s,'-]*$/

	//Adding event listener to all fields
	let firstName = document.getElementById("firstName");
	firstName.addEventListener("input", validate);

	let lastName = document.getElementById("lastName");
	lastName.addEventListener("input", validate);

	let emailId = document.getElementById("emailId");
	emailId.addEventListener("input", validate);

	let phoneNumber = document.getElementById("phoneNumber");
	phoneNumber.addEventListener("input", validate);

	let zipCode = document.getElementById("zipCode");
	zipCode.addEventListener("input", validate);

	let miss = document.getElementById("miss");
	miss.addEventListener("input", validate)
	let mr = document.getElementById("mr");
	mr.addEventListener("input", validate)
	let mrs = document.getElementById("mrs");
	mrs.addEventListener("input", validate);

	let checkbox_FB = document.getElementById("checkbox_FB");
	checkbox_FB.addEventListener("input", validate)
	let checkbox_Google = document.getElementById("checkbox_Google");
	checkbox_Google.addEventListener("input", validate)
	let checkbox_Yelp = document.getElementById("checkbox_Yelp")
	checkbox_Yelp.addEventListener("input", validate)

	let commentText = document.getElementById("comments");
	commentText.addEventListener('input', validate)

	let addressField1 = document.getElementById('address1');
	addressField1.addEventListener('input', validate)

	let addressField2 = document.getElementById('address2');
	addressField2.addEventListener('input', validate)


	//validating function
	function validate(e){
		let value = e.target.value;
		let type = this.id;
		let em = "error_" + type;

		//setting radio button, checkbox and comment box state
		// let miss = document.getElementById("miss");
		// let mr = document.getElementById("mr");
		// let mrs = document.getElementById("mrs");

		// let checkbox_FB = document.getElementById("checkbox_FB");
		// let checkbox_Google = document.getElementById("checkbox_Google");
		// let checkbox_Yelp = document.getElementById("checkbox_Yelp");

		// let commentText = document.getElementById("comments").value;
		
		console.log(commentText.value);
		
		if(miss.checked || mrs.checked || mr.checked){
			validCheck.radioState = true;
		} else validCheck.radioState = false;

		if(checkbox_FB.checked || checkbox_Google.checked || checkbox_Yelp.checked){
			validCheck.checkboxState = true;
 		} else validCheck.checkboxState = false;

		 if(commentText.value === ""){
			validCheck.textAreaState = false;
			} else validCheck.textAreaState = true;

		switch(type){
			case "firstName":
				if(!value.trim().match(regExFirstName)){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validFirstName = false;
					console.log("valid first name:", validCheck.validFirstName);
				} else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validFirstName = true;
					console.log("valid first name", validCheck.validFirstName)
				} 
				break;
		
				case "lastName":
				if(!value.trim().match(regExLastName) && !null){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validLastName = false;
					console.log("valid last name:", validCheck.validLastName);
				} else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validLastName = true;
					console.log("valid last name", validCheck.validLastName)
				} 
				break;

				case "emailId":
				if(!value.trim().match(regExEmailId)){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validEmailId = false;
					console.log("valid Email ID:", validCheck.validEmailId);
				} else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validEmailId = true;
					console.log("valid Email ID", validCheck.validEmailId)
				} 
				break;

				case "phoneNumber":
				if(!value.trim().match(regExPhoneNumber)){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validPhoneNumber = false;
					console.log("valid phone number:", validCheck.validPhoneNumber);
				} else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validPhoneNumber = true;
					console.log("valid phone number", validCheck.validPhoneNumber)
				} 
				break;

				case "zipCode":
				if(!value.trim().match(regExZipCode)){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validZipCode = false;
					console.log("valid Zipcode:", validCheck.validZipCode);
				} else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validZipCode = true;
					console.log("valid Zipcode", validCheck.validZipCode)
				} 
				break;	

				case "address1":
				if(!value.trim().match(regExAddress)){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validAddress1 = false;
					console.log("valid Address 1 :", validCheck.validAddress1);
				} else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validAddress1 = true;
					console.log("valid Address 1 :", validCheck.validAddress1)
				} 
				break;

				//change logic 
				case "address2":
				if(!value.trim().match(regExAddress2)){
					document.getElementById(em).style.display = "block";
					this.style.border = "2px solid red";
					validCheck.validAddress2 = false;
					console.log("valid Address 1 :", validCheck.validAddress2);
				} 
				else {
					document.getElementById(em).style.display = "none";
					this.style.border = "";
					validCheck.validAddress2 = true;
					console.log("valid Address 1 :", validCheck.validAddress2)
				} 
				break;
				
		}
		submitbtn(e);
	}

	//function check submit
	function submitbtn(){
		let submit = document.getElementById("submitBtn");
		console.log(validCheck)
		if(Object.values(validCheck).every((ele) => ele)){
			submitBtn.removeAttribute("disabled")
			// submitBtn.disabled = false;
		} else {
			// submitBtn.disabled = true;
			submitBtn.setAttribute("disabled", true)
		}
		
	}

	//function called when press submit, default behaviour reloads on submit
	function submitted(e){
		e.preventDefault();
		if(Object.values(validCheck).every((ele) => ele)){
			alert("Data entered Successfully");
			document.getElementById("resetBtn").click()
		} else {
			alert("Please enter details in valid format");
		}
	}

	document.getElementById("resetBtn").addEventListener("click", resetBtn);

	function resetBtn(e){
		validCheck = {...defaultvalidCheck};
		submitbtn(e);
	}

	//select car options functionality
	let carsSelect = document.getElementById("cars")
	carsSelect.addEventListener("change", carOptions);
	
	function carOptions(e){
		let cars = { 
			'porsche' : ['Macan', 'Cayenne'],
			'audi' : ['Q3', 'Q5', 'Q7'],
			'bmw' : ['X3', 'X5', 'X7'],
			'lexus' : ['RX SUV', 'LC 500h', 'Lexus NX'],
			'mercedes' : ['AMG A45s', 'E-class', 'Maybach']	
		};

		if(e.target.value){
			validCheck.validCar = true;
		} else validCheck.validCar = false;

		console.log(validCheck);

		let carContainer = document.getElementById("carContainer");
		if(carContainer){
			carContainer.innerHTML = "";
		} else {
			carContainer = document.createElement("div");
			carContainer.setAttribute('id', 'carContainer');
			carsSelect.nextElementSibling.after(carContainer);	
			carContainer.style.paddingLeft = "148px";
		}	

		(cars[e.target.value] ?? []).forEach(element => {
			let spanElement = document.createElement("span");
			spanElement.setAttribute("id", "span_" + element);
			let optionElement = document.createElement("input");
			optionElement.setAttribute("type", "checkbox");
			optionElement.setAttribute("value", element);
			optionElement.id = "checkBox_" + element;
			optionElement.addEventListener("change", checkBoxToggle);
			spanElement.appendChild(optionElement);
			spanElement.append(element);
			spanElement.style.display = "block";
			carContainer.appendChild(spanElement);
		});
		submitbtn();
	}	

	
	function checkBoxToggle(e){
		
			let checkBoxElements = document.querySelectorAll('input[id^="checkBox_"]');
			if(Array.from(checkBoxElements).filter(ele => ele.checked).length > 0){
				validCheck.validCarCheckbox = true;
			} else validCheck.validCarCheckbox = false;

			

			let em = document.getElementById("error_" + e.target.value);
			let textBoxForModel = document.getElementById("textbox_" + e.target.value);
			
			if(textBoxForModel){
				textBoxForModel.remove();
				em.remove();

			} else {
				em = document.createElement('div');
				em.id = "error_" + e.target.value;
				em.style.display = "none";
				em.style.color = "red";
				em.textContent = "Invalid Selection Please try again";
				em.style.border = "none";
				textBoxForModel = document.createElement('input');
				textBoxForModel.setAttribute("type", "text");
				textBoxForModel.setAttribute("id", "textbox_" + e.target.value);
				textBoxForModel.setAttribute("name", "textbox_" + e.target.value);
				textBoxForModel.setAttribute("placeholder", "textbox_" + e.target.value);
				textBoxForModel.minLength = 1;
				let spanElement = document.getElementById("span_" + e.target.value);
				textBoxForModel.addEventListener("input", validateCheckbox);
				
				spanElement.appendChild(textBoxForModel);
				spanElement.appendChild(em);		
			}
			let textBoxElements = document.querySelectorAll('input[id^="textbox_"]');
				if(Array.from(textBoxElements).every(ele => ele.value)){
					validCheck.validCarCheckboxText = true;
				} else validCheck.validCarCheckboxText = false;
			submitbtn();
		}

		function validateCheckbox(e){
			let textBoxElements = document.querySelectorAll('input[id^="textbox_"]');
			if(Array.from(textBoxElements).every(ele => ele.value)){
				validCheck.validCarCheckboxText = true;
			} else validCheck.validCarCheckboxText = false;
			console.log(e);
			let em = document.getElementById("error_" + e.target.id.split("_")[1]);
			console.log(em);
			if(e.target.value){
				em.style.display = "none"
			} else {
				em.style.display = "block"
			}
			submitbtn();
		}

 </script>

 </body>
</html>
